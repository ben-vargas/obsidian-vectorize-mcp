# Upgrade configuration for existing v1 deployments
# Use this file if you already have ObsidianVectorizeMCP deployed with v1 migration
# Copy this to wrangler.toml: cp wrangler.toml.upgrade wrangler.toml

name = "obvec"
main = "src/index.ts"
compatibility_date = "2025-07-30"
compatibility_flags = ["nodejs_compat"]

# Standard MCP Durable Object (already exists from v1)
[[durable_objects.bindings]]
name = "MCP_OBJECT"
class_name = "ObsidianVectorizeMCP"
script_name = "obvec"

# ChatGPT-specific Durable Object (new in v2)
[[durable_objects.bindings]]
name = "CHATGPT_MCP_OBJECT"
class_name = "ChatGPTMCP"
script_name = "obvec"

# Migration v2 only adds ChatGPTMCP since ObsidianVectorizeMCP already exists
[[migrations]]
tag = "v2"
new_sqlite_classes = ["ChatGPTMCP"]

[vars]
EMBEDDING_MODEL = "@cf/baai/bge-large-en-v1.5"
EMBEDDING_DIMENSIONS = "1024"
# Set your Obsidian vault name for proper URL generation in ChatGPT
OBSIDIAN_VAULT_NAME = "YourVaultName"
# Minimum score threshold for ChatGPT search results (0.0-1.0, default: 0.3)
# Lower values return more results, higher values return only best matches
CHATGPT_MIN_SCORE = "0.3"
# Enable Query Deserves Freshness (QDF) time-based scoring (true/false, default: false)
# When enabled, ChatGPT's freshness hints boost recent notes in search results
CHATGPT_USE_QDF = "false"

# Authentication Configuration
# Set your MCP password using: wrangler secret put MCP_PASSWORD

[ai]
binding = "AI"

[[vectorize]]
binding = "VECTORIZE"
index_name = "obsidian-notes"

# KV namespace for general storage
# Use your existing KV namespace ID from v1 deployment
[[kv_namespaces]]
binding = "KV"
id = "YOUR_EXISTING_KV_NAMESPACE_ID"

# KV namespace for OAuth tokens
# Use your existing OAuth KV namespace ID from v1 deployment
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "YOUR_EXISTING_OAUTH_KV_NAMESPACE_ID"

# R2 bucket for note content and metadata
# Use your existing R2 bucket from v1 deployment
[[r2_buckets]]
binding = "R2"
bucket_name = "YOUR_EXISTING_R2_BUCKET"